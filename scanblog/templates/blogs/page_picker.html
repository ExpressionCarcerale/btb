{% extends "blogs/base.html" %}

{% block title %}By the page{% endblock %}

{% block body %}
<style type='text/css'>
    .pagepick {
        float: left;
        cursor: pointer;
        border: 1px solid white;
    }
    .pagepick:hover {
        border: 1px solid green;
    }

</style>
<noscript>
    This page requires javsacript.  To browse Between the Bars without javascript, try <a href='{% url blogs.home %}'>blogs</a>.
</noscript>
<h1>Every page</h1>
<div id='pagepicker'></div>
{% endblock %}

{% block scripts %}
<script type='text/javascript'>
    var manifest, manifestIndex;
    var pageData = [];

    function loadImages() {
        (function(manifestIndex) {
            var dataset = manifest[manifestIndex];
            for (var i = 0; i < dataset.num_images; i++) {
                (function(i) {
                    $("#pagepicker").append($("<div>").attr(
                        "class", "pagepick" 
                    ).css({
                        backgroundPosition: (-i * dataset.image_size[0]) + "px 0px",
                        backgroundImage: "url(" + dataset.image + ")",
                        width: dataset.image_size[0] + "px",
                        height: dataset.image_size[1] + "px"
                    }).attr({
                        "data-dataset": manifestIndex,
                        "data-index": i
                    }).click(function() {
                        var data = pageData[manifestIndex].data[i];
                        console.log(data);
                        document.location.href = data.url;
                    }));

                })(i);
            }
            $.get(dataset.datafile, function(data) {
                pageData[manifestIndex] = data; 
            });
        })(manifestIndex);
    }

    $.get("{{ PUBLIC_MEDIA_URL }}pagepicker/manifest.json", function(data) {
        manifest = data.images;
        manifestIndex = 0;
        loadImages();
    });

</script>
{% endblock %}
